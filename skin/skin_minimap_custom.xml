<action name="switch_minimap_custom">
    set(layer[skin_minimap_container].state, 'small');
    set(layer[btn_resize_map].html, '&#8694;');
    tween(layer[skin_minimap_container].width, 60, 0.25, easeOutQuint);
    tween(layer[skin_minimap_container].height, 50, 0.25, easeOutQuint);
    if(layer[skin_minimap_container].visible == true,
        tween(layer[skin_minimap_container].alpha, 0.0, 0.25, default, set(layer[skin_minimap_container].visible,false));
    ,
        set(layer[skin_minimap_container].visible, true);
        tween(layer[skin_minimap_container].alpha, 1.0, 0.25);
        if(layer[skin_minimap].map, layer[skin_minimap].map.updateSize(); );
    );
</action>
<!-- Minimappa personalizzata per krpano: layer e action riutilizzabili -->
<layer name="skin_minimap_container" parent="STAGE" keep="true" type="container" 
    align="lefttop" 
    x="-4" y="0" 
    width="60" height="50" 
    maskchildren="false" 
    bgborder="4 0xFFFFFF 1.0" bgshadow="0 2 18 0x000000 0.7" zorder="999"
    safearea="false"
    state="small"
    onresize="update_minimap_size_on_resize();">

    <layer name="skin_minimap" state="opened" url="" visible="true" 
           align="lefttop" width="100%" height="100%" x="0" y="0" zorder="1" 
           lat="0" lng="0" zoom="21" bgcolor="0x000000" bgalpha="0.95" maptype="satellite" 
           css="overflow:hidden; box-sizing:border-box;" 
           onmapready="skin_addmapspots_minimap(); txtadd(layer[skin_minimap].onmapclick, 'skin_minimap_click(%1,%2);');">
        <maptypecontrol visible="false" align="righttop" x="6" y="6" buttonalign="v" scale.mobile="1.0" />
        <radar visible="true" headingoffset="0" />
        <spotstyle name="DEFAULT" url="vtourskin_mapspot.png" activeurl="vtourskin_mapspotactive.png" edge="bottom" x="-6" y="-10" scale="0.6" />
    </layer>

    <layer name="btn_resize_map" type="text" keep="true"
           align="righttop" x="0" y="0" width="40" height="40" 
           css="text-align:center; line-height:38px; font-weight:bold; font-family:Arial; color:#FFFFFF; font-size:24px; cursor:pointer;"
           bg="true" bgcolor="0x2D3E50" bgalpha="1.0" 
           bgcapture="true"
           capture="true"
           html="&#8694;" 
           tooltip="Espandi / Riduci"
           onclick="toggle_minimap_size();" 
           zorder="10000"
    />

</layer>

<action name="toggle_minimap_size">
    trace('Pulsante ridimensiona premuto. Stato attuale: ', layer[skin_minimap_container].state);
    if(layer[skin_minimap_container].state == 'small',
        set(var_expand_width, calc(min(600, stagewidth-20)));
        set(var_expand_height, calc(min(stageheight-20, stageheight*0.7)));
        tween(layer[skin_minimap_container].width, var_expand_width, 0.5, easeOutQuint);
        tween(layer[skin_minimap_container].height, var_expand_height, 0.5, easeOutQuint);
        set(layer[skin_minimap_container].state, 'big');
        set(layer[btn_resize_map].html, '&#8690;');
        if(layer[skin_minimap].map, layer[skin_minimap].map.updateSize(); );
    ,
        set(layer[skin_minimap_container].width, 60);
        set(layer[skin_minimap_container].height, 50);
        set(layer[skin_minimap_container].state, 'small');
        set(layer[btn_resize_map].html, '&#8694;');
        if(layer[skin_minimap].map, layer[skin_minimap].map.updateSize(); );
    );

<action name="update_minimap_size_on_resize">
    if(layer[skin_minimap_container].state == 'big',
        set(var_expand_width, calc(min(600, stagewidth-20)));
        set(var_expand_height, calc(min(stageheight-20, stageheight*0.7)));
        set(layer[skin_minimap_container].width, var_expand_width);
        set(layer[skin_minimap_container].height, var_expand_height);
        if(layer[skin_minimap].map, layer[skin_minimap].map.updateSize(); );
    );
</action>
</action>
